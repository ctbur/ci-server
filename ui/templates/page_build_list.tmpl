{{ define "page_build_list" }}
<!doctype html>
<html lang="en">
    <head>
        {{ template "comp_head" }}

        <title>CI</title>
    </head>

    <body>
        <header>
            <h1>Builds</h1>
        </header>

        <main>
            <div
                id="update-poller"
                hx-get="/hx/builds?page={{ .CurrentPage }}"
                hx-trigger="
                    every 1s [document.visibilityState === 'visible'],
                    visibilitychange[document.visibilityState === 'visible'] from:document
                "
                hx-swap="innerHTML"
            ></div>

            <section id="builds">
                {{ template "comp_build_list" . }}
            </section>

            {{ template "build_list_nav" . }}
        </main>

    </body>
</html>
{{ end }}


{{ define "resp_build_list_update" }}
{{ template "comp_build_list" . }}

{{ template "build_list_nav" . }}
{{ end }}


{{ define "comp_build_list" }}
<ul id="build-list" class="build-list" hx-swap-oob="innerHTML">
    {{- range .BuildCards }}
        <a href="/builds/{{ .ID }}" class="build-card-link">
            <li class="build-card">
                <div class="build-details-item status">
                    {{ template "comp_build_status_icon" .Status }}
                </div>
                <div class="build-details-item author">{{ .Author }}</div>
                <div class="build-details-item message">{{ .Message }}</div>
                <div class="build-details-item ref">{{ .Ref }}</div>
                <div class="build-details-item duration">
                    {{ if .Duration }}{{ formatDuration .Duration }}{{ else }}N/A{{ end }}
                </div>
                <div class="build-details-item commit-sha">{{ .CommitSHA }}</div>
                <div class="build-details-item created">{{ formatTime .Started "Jan 2, 15:04" }}</div>
            </li>
        </a>
    {{- end }}
</ul>
{{ end }}


{{ define "build_list_nav" }}
<nav style="text-align: center; margin-top: 2rem;" id="build-list-nav" hx-swap-oob="innerHTML">
    {{ if ne .PreviousPage nil }}
        <a class="button"
            href="?page={{ .PreviousPage }}"
            aria-label="Previous Page"
        >
            &laquo; Previous
        </a>
    {{ end }}

    <span style="margin: 0 1rem; font-weight: bold;">
        Page {{ .CurrentPage }}
    </span>

    {{ if ne .NextPage nil }}
        <a class="button"
                href="?page={{ .NextPage }}"
            aria-label="Next Page"
        >
        Next &raquo;
        </a>
    {{ end }}
</nav>
{{ end }}
